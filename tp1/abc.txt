SELECT * FROM REVIEW
WHERE ASSIN = 'B00005O06B' AND HELPFUL > 0
ORDER BY RATING ASC, HELPFUL DESC
LIMIT 5; --pegar menos rating e mais helpful


SELECT * FROM REVIEW
WHERE ASSIN = 'B00005O06B' AND HELPFUL > 0
ORDER BY HELPFUL DESC, RATING DESC
LIMIT 5; --pegar mais helpful e mais rating


SELECT COSTUMER, COUNT(*) AS APARICAO
FROM REVIEW, (SELECT assin FROM product 
                      WHERE "group" = 'Book') AS PROD
WHERE REVIEW.ASSIN = PROD.ASSIN
GROUP BY COSTUMER
ORDER BY APARICAO DESC
LIMIT 10; --desocupado que comenta pra caralho



SELECT DATA, ROUND(AVG(RATING),1) AS MEDIA
FROM REVIEW
WHERE ASSIN = 'B00005O06B'
GROUP BY DATA; --EVOLUÇÃO


WITH RankedReviews AS (SELECT P."group", R.assin, COUNT (R.ID) AS TotalReviews, ROW_NUMBER() OVER (PARTITION BY P."group" ORDER BY COUNT (R.ID) DESC) AS rank
    FROM Review R
    JOIN PRODUCT P ON R.ASSIN = P.ASSIN
    GROUP BY P."group", R.assin
)

SELECT "group", ASSIN, TotalReviews
FROM RankedReviews
WHERE rank <= 10
ORDER BY "group", TotalReviews
;